import Link from "next/link";
import { getVar, varsToCssStyle } from "@/lib/vars";
import { Button } from "@/components/ui/button";
import { Card, CardContent, CardFooter, CardHeader, CardTitle } from "@/components/ui/card";
import { Badge } from "@/components/ui/badge";
import { Input } from "@/components/ui/input";
import { Label } from "@/components/ui/label";
import { Textarea } from "@/components/ui/textarea";

function csv(key: string, fallback: string): string[] {
  const v = String(getVar(key, fallback));
  return v
    .split(",")
    .map((s) => s.trim())
    .filter(Boolean);
}

export default function Page() {
  const logo = String(getVar("header-logo-or-name", "SWE Portfolio"));
  const navItems = csv(
    "header-header-links",
    "Home, About, Projects, Contact"
  );
  const skills = csv(
    "about-section-skills",
    "JavaScript, TypeScript, React, Node.js, GraphQL"
  );

  const anchors: Record<string, string> = {
    home: "#portfolio-page",
    about: "#about-section",
    projects: "#projects-section",
    contact: "#contact-section",
  };

  const projectTitle = String(
    getVar("projects-section-project-card-title", "Title Placeholder")
  );
  const projectDesc = String(
    getVar(
      "projects-section-project-card-description",
      "Description Placeholder"
    )
  );
  const projectLink = String(
    getVar("projects-section-project-card-link", "https://example.com")
  );

  const namePh = String(
    getVar("contact-section-name-placeholder", "Your name")
  );
  const emailPh = String(
    getVar("contact-section-email-placeholder", "Your email")
  );
  const messagePh = String(
    getVar("contact-section-message-placeholder", "Your message")
  );
  const submitText = String(
    getVar("contact-section-submit-button-text", "Send")
  );

  const footerLinks = csv(
    "footer-social-media-links",
    "LinkedIn, GitHub, Twitter"
  );

  return (
    <section
      id="portfolio-page"
      style={varsToCssStyle()}
      className="min-h-screen bg-[var(--portfolio-page-background-color)] text-[var(--portfolio-page-text-color)] antialiased p-[var(--portfolio-page-padding)]"
    >
      <header
        id="header"
        className="mb-12 rounded-xl border bg-[var(--header-background-color)] text-[var(--header-text-color)] shadow-sm"
      >
        <div className="mx-auto max-w-6xl px-6 py-[var(--header-padding)]">
          <div className="flex flex-wrap items-center justify-between gap-6">
            <Link href="#portfolio-page" className="text-xl font-semibold tracking-tight">
              {logo}
            </Link>
            <nav aria-label="Main navigation" className="w-full md:w-auto">
              <ul className="flex flex-wrap items-center gap-4 md:gap-6">
                {navItems.map((item) => {
                  const key = item.toLowerCase();
                  const href = anchors[key] ?? "#portfolio-page";
                  return (
                    <li key={item}>
                      <Link
                        href={href}
                        className="text-sm font-medium text-[var(--header-text-color)]/80 transition-colors hover:text-[var(--header-text-color)]"
                      >
                        {item}
                      </Link>
                    </li>
                  );
                })}
              </ul>
            </nav>
          </div>
        </div>
      </header>

      <section
        id="about-section"
        className="mb-16 rounded-xl bg-[var(--about-section-background-color)] text-[var(--about-section-text-color)] px-6 py-[var(--about-section-padding)] shadow-sm"
      >
        <div className="mx-auto grid max-w-6xl gap-10 lg:grid-cols-3">
          <div className="lg:col-span-2">
            <h2 className="text-3xl font-bold tracking-tight">About</h2>
            <p className="mt-4 text-base leading-7 opacity-90">
              {String(
                getVar(
                  "about-section-biography",
                  "A software engineer passionate about building scalable and maintainable applications."
                )
              )}
            </p>
          </div>
          <div>
            <h3 className="text-lg font-semibold">Skills</h3>
            <div className="mt-4 flex flex-wrap gap-2">
              {skills.map((s) => (
                <Badge key={s} variant="secondary">
                  {s}
                </Badge>
              ))}
            </div>
          </div>
        </div>
      </section>

      <section
        id="projects-section"
        className="mb-16 rounded-xl bg-[var(--projects-section-background-color)] text-[var(--projects-section-text-color)] px-6 py-[var(--projects-section-padding)] shadow-sm"
      >
        <div className="mx-auto max-w-6xl">
          <div className="mb-8 flex items-end justify-between gap-4">
            <h2 className="text-3xl font-bold tracking-tight">Projects</h2>
            <Link href="#contact-section" className="text-sm font-medium text-primary">
              Get in touch
            </Link>
          </div>
          <div className="grid gap-6 sm:grid-cols-2 lg:grid-cols-3">
            {[0, 1, 2].map((i) => (
              <Card key={i} className="flex flex-col">
                <CardHeader>
                  <CardTitle className="text-xl">{projectTitle}</CardTitle>
                </CardHeader>
                <CardContent className="text-sm opacity-90">
                  {projectDesc}
                </CardContent>
                <CardFooter className="mt-auto">
                  <Link
                    href={projectLink}
                    className="inline-flex w-full items-center justify-center rounded-md border border-input px-4 py-2 text-sm font-medium text-primary shadow-sm transition-colors hover:bg-accent hover:text-accent-foreground"
                  >
                    View Project
                  </Link>
                </CardFooter>
              </Card>
            ))}
          </div>
        </div>
      </section>

      <section
        id="contact-section"
        className="mb-16 rounded-xl bg-[var(--contact-section-background-color)] text-[var(--contact-section-text-color)] px-6 py-[var(--contact-section-padding)] shadow-sm"
      >
        <div className="mx-auto max-w-3xl">
          <h2 className="text-3xl font-bold tracking-tight">Contact</h2>
          <p className="mt-2 text-sm opacity-80">Let's build something great together.</p>
          <form className="mt-8 grid gap-6" method="post">
            <div className="grid gap-2">
              <Label htmlFor="name">Name</Label>
              <Input id="name" name="name" placeholder={namePh} aria-label="Your name" />
            </div>
            <div className="grid gap-2">
              <Label htmlFor="email">Email</Label>
              <Input
                id="email"
                name="email"
                type="email"
                inputMode="email"
                placeholder={emailPh}
                aria-label="Your email"
              />
            </div>
            <div className="grid gap-2">
              <Label htmlFor="message">Message</Label>
              <Textarea id="message" name="message" placeholder={messagePh} aria-label="Your message" rows={6} />
            </div>
            <div className="flex items-center justify-end">
              <Button type="submit">{submitText}</Button>
            </div>
          </form>
        </div>
      </section>

      <footer
        id="footer"
        className="rounded-xl bg-[var(--footer-background-color)] text-[var(--footer-text-color)] px-6 py-[var(--footer-padding)] shadow-sm"
      >
        <div className="mx-auto flex max-w-6xl flex-col items-center justify-between gap-4 sm:flex-row">
          <p className="text-xs opacity-80">
            {String(getVar("footer-copyright-text", "Â© 2023 SWE Portfolio"))}
          </p>
          <nav aria-label="Social media">
            <ul className="flex items-center gap-4">
              {footerLinks.map((name) => {
                const key = name.toLowerCase();
                const href =
                  key.includes("github")
                    ? "https://github.com"
                    : key.includes("linkedin")
                    ? "https://www.linkedin.com"
                    : key.includes("twitter")
                    ? "https://twitter.com"
                    : "#";
                return (
                  <li key={name}>
                    <Link
                      href={href}
                      className="text-sm font-medium opacity-90 transition-colors hover:opacity-100"
                    >
                      {name}
                    </Link>
                  </li>
                );
              })}
            </ul>
          </nav>
        </div>
      </footer>
    </section>
  );
}
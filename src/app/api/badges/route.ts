import { NextRequest } from 'next/server';

export async function GET(request: NextRequest) {
  const { searchParams } = new URL(request.url);
  const text = searchParams.get('text') || 'Manta Graph';
  const link = searchParams.get('link');

  // Calculate text width for centering (approximate)
  const textWidth = text.length * 7.5; // rough estimate for font-size 110 scaled by 0.1 = 11px
  const totalWidth = Math.max(109, 24 + textWidth + 10); // minimum 109, or logo width + text + padding

  // Center text in the blue area (starting at x=24)
  const blueAreaStart = 24;
  const blueAreaWidth = totalWidth - 24;
  const textCenterX = blueAreaStart + blueAreaWidth / 2;
  const scaledTextCenterX = textCenterX * 10;
  const scaledTextWidth = textWidth * 10;

  const linkHref = link ? `/${link}` : '';
  const linkStart = link ? `<a xlink:href="${linkHref}" xmlns:xlink="http://www.w3.org/1999/xlink">` : '';
  const linkEnd = link ? '</a>' : '';

  const svg = `<svg xmlns="http://www.w3.org/2000/svg" width="${totalWidth}" height="20" role="img" aria-label="${text}"><title>${text}</title><linearGradient id="s" x2="0" y2="100%"><stop offset="0" stop-color="#bbb" stop-opacity=".1"/><stop offset="1" stop-opacity=".1"/></linearGradient><linearGradient id="bg" x1="0%" y1="0%" x2="100%" y2="100%"><stop offset="0%" stop-color="#7c3aed"/><stop offset="100%" stop-color="#3b82f6"/></linearGradient><clipPath id="r"><rect width="${totalWidth}" height="20" rx="3" fill="#fff"/></clipPath>${linkStart}<g clip-path="url(#r)"><rect width="24" height="20" fill="black"/><rect x="24" width="${totalWidth - 24}" height="20" fill="url(#bg)"/><rect width="${totalWidth}" height="20" fill="url(#s)"/></g><g fill="#fff" text-anchor="middle" font-family="Verdana,Geneva,DejaVu Sans,sans-serif" text-rendering="geometricPrecision" font-size="110">
   
<svg version="1.1" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="-30 0 400 400">
<path d="M0 0 C8.04141327 -0.0931181 16.08259727 -0.16397484 24.12441826 -0.20724869 C27.8595079 -0.22802924 31.5942258 -0.25616923 35.32910156 -0.30175781 C38.94069135 -0.34556031 42.551926 -0.36920859 46.16376114 -0.37950897 C47.53434964 -0.38683928 48.90492106 -0.40115198 50.27535629 -0.42292023 C62.68272449 -0.61197172 71.33654593 1.47229501 80.51513672 10.11401367 C97.60886964 27.1508217 105.49208434 54.9326781 114.60009766 76.66357422 C116.930599 82.2179222 119.27776769 87.76520627 121.625 93.3125 C122.0780249 94.3837915 122.5310498 95.45508301 122.99780273 96.55883789 C126.68109005 105.26255542 130.39513282 113.95287279 134.125 122.63671875 C134.44210938 123.37841309 134.75921875 124.12010742 135.0859375 124.88427734 C135.68442768 126.26956472 136.29344003 127.65036469 136.9140625 129.02587891 C138.19087775 131.88006813 139 133.83205364 139 137 C139.66 137 140.32 137 141 137 C141.26167969 136.16726562 141.52335938 135.33453125 141.79296875 134.4765625 C143.11005332 130.68301793 144.67624629 127.03776588 146.3125 123.375 C146.94736169 121.9378298 147.5814724 120.50032763 148.21484375 119.0625 C148.67673096 118.01449219 148.67673096 118.01449219 149.14794922 116.9453125 C151.92806414 110.59804727 154.52435877 104.17305933 157.1328125 97.75390625 C157.92159407 95.81498986 158.71066338 93.8761905 159.5 91.9375 C160.09421753 90.47751587 160.09421753 90.47751587 160.70043945 88.98803711 C162.56612836 84.42517291 164.45502529 79.89534482 166.5625 75.4375 C169.27378166 69.62761072 171.44685415 63.62128927 173.69628906 57.62207031 C176.80365154 49.39089633 180.16330771 41.27530814 183.58666992 33.17114258 C183.98732666 32.22134521 184.3879834 31.27154785 184.80078125 30.29296875 C185.37276245 28.93800293 185.37276245 28.93800293 185.95629883 27.55566406 C186.90152796 25.24112406 187.7600728 22.91500511 188.59375 20.55859375 C191.71518831 12.65962068 198.96671273 5.73673776 206.7091217 2.22473145 C213.77340538 -0.47561335 220.51673179 -0.38454269 228.00390625 -0.29296875 C229.32293442 -0.28872391 230.64196259 -0.28447906 232.0009613 -0.28010559 C235.47805385 -0.26874678 238.95475996 -0.23935931 242.43170166 -0.20599365 C245.991524 -0.1750972 249.55140985 -0.16155879 253.11132812 -0.14648438 C260.07437574 -0.114479 267.03716922 -0.06339386 274 0 C274 3.3 274 6.6 274 10 C272.78763672 10.51046875 272.78763672 10.51046875 271.55078125 11.03125 C264.56403301 14.20014908 260.02891525 16.78902917 257 24 C255.75818936 27.72543192 255.79923356 31.21416319 255.76171875 35.09765625 C255.7519249 35.93315002 255.74213104 36.7686438 255.73204041 37.62945557 C255.35552903 78.81562976 258.74935542 119.74821102 263 160.6875 C263.11933899 161.86414215 263.23867798 163.0407843 263.3616333 164.25308228 C265.26264524 190.08303429 265.26264524 190.08303429 277.8125 211.8125 C281.48614792 214.33363093 284.79255493 215.57374743 289 217 C291.83823106 219.83823106 290 224.98613514 290 229 C255.35 229 220.7 229 185 229 C185 225.37 185 221.74 185 218 C186.53720703 217.67128906 186.53720703 217.67128906 188.10546875 217.3359375 C196.50996734 215.7721732 196.50996734 215.7721732 203.3125 211.125 C206.77690828 204.70942911 207.35425999 199.27904722 207.3125 192.125 C207.30903564 191.12162598 207.30557129 190.11825195 207.30200195 189.08447266 C207.17004696 179.45394499 206.25325524 169.93289131 205.27856445 160.35766602 C204.09234967 148.60725622 203.25692429 136.84776222 202.5 125.0625 C202.37680741 123.15884779 202.25351626 121.25520196 202.13012695 119.3515625 C201.94375788 116.47530159 201.75739707 113.59904042 201.57151794 110.7227478 C200.94158835 101.01467414 200.27015378 91.30974347 199.57104492 81.60641479 C199.44110957 79.79607792 199.31267362 77.98563275 199.18579102 76.17507935 C199.01047052 73.67632567 198.83017426 71.17798159 198.6484375 68.6796875 C198.59750946 67.94128128 198.54658142 67.20287506 198.49411011 66.4420929 C198.27001617 63.43275799 197.95924179 60.87772537 197 58 C194.72039952 63.39972404 192.44591506 68.80157238 190.17529297 74.20507812 C189.43318959 75.96984744 188.69015063 77.7342239 187.94580078 79.49804688 C177.28154282 104.77852262 167.07031351 130.25554658 156.91015625 155.7421875 C153.73215919 163.69816529 150.47916369 171.62296115 147.22174072 179.54669189 C145.81179505 182.97640867 144.40336085 186.40674551 142.99481201 189.83703613 C142.29734035 191.53555482 141.59979098 193.2340416 140.90216064 194.93249512 C138.13835835 201.66139016 135.37925147 208.39218901 132.625 215.125 C132.2746167 215.98101807 131.9242334 216.83703613 131.56323242 217.71899414 C131.08720581 218.88289673 131.08720581 218.88289673 130.6015625 220.0703125 C130.20445068 221.04121826 130.20445068 221.04121826 129.79931641 222.03173828 C128.85747304 224.35096285 127.92965485 226.67586287 127 229 C123.37 229 119.74 229 116 229 C113.80927774 224.02224535 111.62197899 219.04299771 109.4375 214.0625 C109.1149826 213.32726105 108.79246521 212.59202209 108.46017456 211.83450317 C104.62525363 203.0851568 100.8419602 194.32517124 97.2668457 185.46582031 C95.27257129 180.56130762 93.04641131 175.78549439 90.76391602 171.01147461 C87.68894903 164.49602087 85.03720421 157.81473637 82.34521484 151.13427734 C80.12575309 145.6582133 77.80166987 140.26665123 75.25 134.9375 C72.64308208 129.47851821 70.42320655 123.97298279 68.30859375 118.30859375 C66.60614058 114.0041823 64.64700304 109.84716678 62.6628418 105.66723633 C58.86513964 97.65124296 55.35862543 89.51057151 52.125 81.25 C49.02701993 73.38589675 45.46004884 65.70952631 42 58 C40.24817549 59.75182451 40.70066374 62.24109852 40.56689453 64.62915039 C40.49646942 65.84279266 40.42604431 67.05643494 40.35348511 68.30685425 C40.27992123 69.6537879 40.20636389 71.00072191 40.1328125 72.34765625 C40.05315807 73.73954054 39.97299939 75.13139605 39.8923645 76.52322388 C39.72113335 79.49047976 39.55243196 82.45786319 39.38586426 85.42538452 C38.95232457 93.14615791 38.50600563 100.86618461 38.0546875 108.5859375 C38.01020477 109.34875471 37.96572205 110.11157192 37.91989136 110.89750481 C37.2374205 122.55263618 36.41087958 134.18855612 35.4447937 145.82388306 C34.39947962 158.50767135 33.68205542 171.14661784 33.5625 183.875 C33.54026367 185.16559326 33.51802734 186.45618652 33.49511719 187.78588867 C33.51623253 196.53995617 34.76663869 203.72055121 40.125 210.8125 C46.16109502 215.40518099 52.3884118 218.50359207 60 219 C60.02689216 220.47906892 60.04634621 221.95827483 60.0625 223.4375 C60.07410156 224.26121094 60.08570312 225.08492187 60.09765625 225.93359375 C60 228 60 228 59 229 C56.69946165 229.09443335 54.39597827 229.11742128 52.09350586 229.11352539 C51.37159561 229.11367142 50.64968536 229.11381744 49.90589905 229.1139679 C47.50885053 229.11326869 45.11187877 229.10547595 42.71484375 229.09765625 C41.05717511 229.0957921 39.39950593 229.09436818 37.74183655 229.09336853 C33.37045786 229.08954312 28.99911219 229.07971265 24.62774658 229.06866455 C20.17045539 229.05845092 15.71315889 229.05387101 11.25585938 229.04882812 C2.50389107 229.0380904 -6.24805036 229.02101371 -15 229 C-15 225.37 -15 221.74 -15 218 C-14.13117187 217.79246094 -13.26234375 217.58492187 -12.3671875 217.37109375 C-4.93906323 215.38527529 0.05898116 213.79486007 4 207 C4.37382813 206.37609375 4.74765625 205.7521875 5.1328125 205.109375 C12.87286898 190.08793206 12.32489255 170.21843847 13.8086586 153.74378967 C14.00195136 151.60339195 14.19768433 149.46323022 14.39413452 147.32312012 C17.17862121 116.96125883 19.83329491 86.61009293 20.75 56.125 C20.77341461 55.38382935 20.79682922 54.64265869 20.82095337 53.87902832 C22.1123426 34.69542189 22.1123426 34.69542189 14.23828125 18.0625 C9.8447958 13.91933101 5.7568811 11.74762462 0 10 C0 6.7 0 3.4 0 0 Z " fill="#566FFE" transform="translate(62,85)"/>
<path d="M0 0 C0.33 0.66 0.66 1.32 1 2 C0.46890625 2.45890625 -0.0621875 2.9178125 -0.609375 3.390625 C-4.18324699 6.49493717 -7.71854059 9.58181312 -11 13 C-11.66 12.67 -12.32 12.34 -13 12 C-9.12207712 7.07091854 -5.23883167 3.4576289 0 0 Z " fill="#8B81F8" transform="translate(266,89)"/>
</svg>

<text aria-hidden="true" x="${scaledTextCenterX}" y="150" fill="#010101" fill-opacity=".3" transform="scale(.1)" textLength="${scaledTextWidth}">${text}</text><text x="${scaledTextCenterX}" y="140" transform="scale(.1)" fill="#fff" textLength="${scaledTextWidth}">${text}</text></g>${linkEnd}</svg>`;

  return new Response(svg, {
    headers: {
      'Content-Type': 'image/svg+xml',
      'Cache-Control': 'public, max-age=31536000',
    },
  });
}
